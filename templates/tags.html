{% extends "base.html" %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">{{ t("admin.tags.title") or "标签管理" }}</h1>

<div class="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded">
  <div class="text-sm text-gray-700">
    {{ t("admin.tags.tip") or "这里按封面（仅统计 active 封面）中的 tags 字段（逗号分隔）统计热门标签。可将某个标签加入禁用列表，前端/上传处可据此做提示或过滤。" }}
  </div>
</div>

<div class="grid md:grid-cols-2 gap-6">
  <!-- 热门标签 -->
  <div class="p-4 bg-white shadow rounded-xl">
    <div class="text-sm text-gray-500 mb-2">{{ t("admin.tags.hot") or "热门标签" }}</div>

    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="text-left text-gray-500">
            <th class="py-2 pr-4">#</th>
            <th class="py-2 pr-4">{{ t("admin.tags.tag") or "标签" }}</th>
            <th class="py-2 pr-4">{{ t("admin.tags.count") or "次数" }}</th>
            <th class="py-2 pr-4">{{ t("admin.tags.actions") or "操作" }}</th>
          </tr>
        </thead>
        <tbody>
        {% for tag, cnt in hot %}
          <tr class="border-t">
            <td class="py-2 pr-4">{{ loop.index }}</td>
            <td class="py-2 pr-4">
              <span class="inline-block px-2 py-0.5 rounded bg-gray-100">{{ tag }}</span>
              {% if tag in disabled %}
                <span class="ml-2 text-xs text-red-600">{{ t("admin.tags.disabled") or "已禁用" }}</span>
              {% endif %}
            </td>
            <td class="py-2 pr-4">{{ cnt }}</td>
            <td class="py-2 pr-4">
              {% if tag in disabled %}
              <form method="post" action="/admin/tags/enable" class="inline">
                <input type="hidden" name="tag" value="{{ tag }}">
                <button class="text-sm px-2 py-1 border rounded-md">
                  {{ t("admin.tags.enable") or "启用" }}
                </button>
              </form>
              {% else %}
              <form method="post" action="/admin/tags/disable" class="inline">
                <input type="hidden" name="tag" value="{{ tag }}">
                <button class="text-sm px-2 py-1 border rounded-md">
                  {{ t("admin.tags.disable") or "禁用" }}
                </button>
              </form>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        {% if hot|length == 0 %}
          <tr><td colspan="4" class="py-4 text-center text-gray-400">{{ t("admin.tags.none") or "暂无数据" }}</td></tr>
        {% endif %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- 当前禁用列表 -->
  <div class="p-4 bg-white shadow rounded-xl">
    <div class="text-sm text-gray-500 mb-2">{{ t("admin.tags.disabled_list") or "禁用列表" }}</div>

    <div class="space-y-2">
      {% if disabled|length == 0 %}
        <div class="text-gray-400 text-sm">{{ t("admin.tags.no_disabled") or "（空）" }}</div>
      {% else %}
        {% for tag in disabled|list|sort %}
          <div class="flex items-center justify-between border rounded-md px-3 py-2">
            <span class="text-sm">{{ tag }}</span>
            <form method="post" action="/admin/tags/enable">
              <input type="hidden" name="tag" value="{{ tag }}">
              <button class="text-sm px-2 py-1 border rounded-md">
                {{ t("admin.tags.enable") or "启用" }}
              </button>
            </form>
          </div>
        {% endfor %}
      {% endif %}
    </div>

    <!-- 手动添加禁用 -->
    <div class="mt-4 border-t pt-4">
      <form method="post" action="/admin/tags/disable" class="flex gap-2">
        <input name="tag" class="flex-1 border rounded-md px-2 py-1 text-sm" placeholder="{{ t('admin.tags.tag_placeholder') or '输入要禁用的标签' }}">
        <button class="text-sm px-3 py-1 border rounded-md">{{ t("admin.tags.disable") or "禁用" }}</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
