{% extends "base.html" %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">{{ t("admin.envelopes.title") }} #{{ eid }}</h1>

<!-- æ¦‚è§ˆ -->
<div class="grid md:grid-cols-3 gap-4">
  <div class="p-4 bg-white shadow rounded-xl">
    <div class="text-sm text-gray-500">{{ t("admin.envelopes.summary") }}</div>
    <div class="mt-2 text-sm text-gray-700">
      <div>Token: <b>{{ info.token }}</b></div>
      <div>Total: <b>{{ info.total_amount }}</b> / <b>{{ info.total_count }}</b></div>
      <div>Claimed: <b>{{ info.claimed_amount }}</b> / <b>{{ info.claimed_count }}</b></div>
      <div>Remain: <b>{{ info.remain_amount }}</b> / <b>{{ info.remain_count }}</b></div>
      <div>Created: <b>{{ info.created_at or "â€”" }}</b></div>
      <div>Closed: <b>{{ info.closed_at or "â€”" }}</b></div>
      <div>Creator: <b>{{ info.creator and ("@"+(info.creator.username or "")) or "â€”" }}</b></div>
    </div>
  </div>

  <div class="p-4 bg-white shadow rounded-xl">
    <div class="text-sm text-gray-500">{{ t("admin.envelopes.lucky") }}</div>
    {% if info.lucky %}
      <div class="mt-2 text-sm">
        <div>ðŸ‘‘ {{ info.lucky.username and ("@"+info.lucky.username) or info.lucky.tg_id }}</div>
        <div>+{{ info.lucky.amount }}</div>
      </div>
    {% else %}
      <div class="mt-2 text-sm text-gray-400">â€”</div>
    {% endif %}
  </div>

  <div class="p-4 bg-white shadow rounded-xl">
    <div class="text-sm text-gray-500">{{ t("admin.common.actions") }}</div>
    <div class="mt-2 text-sm text-gray-700">
      <a href="/admin/export" class="inline-block px-3 py-2 border rounded-md">{{ t("admin.export.title") }}</a>
    </div>
  </div>
</div>

<!-- æ˜Žç»† -->
<div class="mt-6 p-4 bg-white shadow rounded-xl">
  <div class="text-sm text-gray-500 mb-2">{{ t("admin.envelopes.claims") }}</div>
  <div class="overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead>
        <tr class="text-left text-gray-500">
          <th class="py-2 pr-4">{{ t("admin.table.user") }}</th>
          <th class="py-2 pr-4">{{ t("admin.table.username") }}</th>
          <th class="py-2 pr-4">{{ t("admin.table.amount") }}</th>
          <th class="py-2 pr-4">{{ t("admin.common.created_at") }}</th>
        </tr>
      </thead>
      <tbody>
        {% for pair in rows %}
          {% set lg = pair[0] %}
          {% set u = pair[1] %}
          <tr class="border-t">
            <td class="py-2 pr-4">{{ u.tg_id }}</td>
            <td class="py-2 pr-4">@{{ u.username or "â€”" }}</td>
            <td class="py-2 pr-4">{{ lg.amount }}</td>
            <td class="py-2 pr-4">{{ lg.created_at or lg.ts or "â€”" }}</td>
          </tr>
        {% endfor %}
        {% if rows|length == 0 %}
          <tr><td colspan="4" class="py-4 text-center text-gray-400">No data</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <div class="flex justify-between mt-4">
    {% if page > 1 %}
      <a href="/admin/envelopes/{{ eid }}?page={{ page - 1 }}" class="text-sm text-gray-700">{{ t("admin.pagination.prev") }}</a>
    {% endif %}
    {% if page < total_pages %}
      <a href="/admin/envelopes/{{ eid }}?page={{ page + 1 }}" class="text-sm text-gray-700">{{ t("admin.pagination.next") }}</a>
    {% endif %}
  </div>
</div>
{% endblock %}
