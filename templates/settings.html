{% extends "base.html" %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">{{ t("admin.settings.title") }}</h1>

<!-- 状态卡片 -->
<div class="grid md:grid-cols-3 gap-4 mb-6">
  <!-- 批量清零开关状态 -->
  <div class="p-4 bg-white rounded-xl shadow">
    <div class="text-sm text-gray-500">{{ t("admin.reset.title") }}</div>
    <div class="text-2xl font-bold mt-1">
      {% if allow_reset %}
        <span class="text-green-600">{{ t("admin.common.on") }}</span>
      {% else %}
        <span class="text-gray-500">{{ t("admin.common.off") }}</span>
      {% endif %}
    </div>
    <p class="text-xs text-gray-500 mt-1">
      {{ t("admin.reset.disallowed") }}
    </p>
  </div>

  <!-- 2FA 状态与动作 -->
  <div class="p-4 bg-white rounded-xl shadow">
    <div class="text-sm text-gray-500">2FA</div>
    <div class="text-2xl font-bold mt-1">
      {% if twofa_ok %}
        <span class="text-green-600">{{ t("admin.twofactor.ok") }}</span>
      {% else %}
        <span class="text-gray-500">{{ t("admin.login.otp_required") }}</span>
      {% endif %}
    </div>
    <div class="flex items-center gap-2 mt-3">
      <form method="post" action="/admin/twofactor/send">
        <button class="px-3 py-1 border rounded-md text-sm">{{ t("admin.twofactor.send") }}</button>
      </form>
      <a href="/admin/twofactor" class="px-3 py-1 border rounded-md text-sm text-gray-700 hover:text-black">
        {{ t("admin.twofactor.verify") }}
      </a>
    </div>
  </div>

  <!-- 功能开关试切 -->
  <div class="p-4 bg-white rounded-xl shadow">
    <div class="text-sm text-gray-500">{{ t("admin.settings.feature_flags") }}</div>
    <form method="post" action="/admin/settings/toggle" class="mt-3">
      <button class="px-3 py-1 border rounded-md text-sm">{{ t("admin.settings.toggle_first") }}</button>
    </form>
  </div>
</div>

<!-- Flags 表 -->
<div class="bg-white rounded-xl shadow overflow-x-auto">
  <table class="min-w-full text-sm">
    <thead>
      <tr class="text-left text-gray-500">
        <th class="py-2 px-3">Key</th>
        <th class="py-2 px-3">{{ t("admin.common.status") }}</th>
        <th class="py-2 px-3">Source</th>
      </tr>
    </thead>
    <tbody>
      {% for k, v, s in flags %}
      <tr class="border-t">
        <td class="py-2 px-3 font-mono">{{ k }}</td>
        <td class="py-2 px-3">
          {% if v is sameas true %}
            <span class="text-green-600">{{ t("admin.common.on") }}</span>
          {% elif v is sameas false %}
            <span class="text-gray-500">{{ t("admin.common.off") }}</span>
          {% else %}
            <span class="text-gray-700">{{ v }}</span>
          {% endif %}
        </td>
        <td class="py-2 px-3">{{ s }}</td>
      </tr>
      {% endfor %}
      {% if flags|length == 0 %}
      <tr><td colspan="3" class="py-6 text-center text-gray-400">No flags</td></tr>
      {% endif %}
    </tbody>
  </table>
</div>

{% if request.query_params.get("toggled") %}
  <div class="mt-4 text-green-600 text-sm">{{ t("admin.toast.done") }}: {{ request.query_params.get("toggled") }}</div>
{% endif %}
{% endblock %}
